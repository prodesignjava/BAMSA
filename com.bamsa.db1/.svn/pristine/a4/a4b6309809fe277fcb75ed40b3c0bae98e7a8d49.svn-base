package com.bamsa.db.dao.impl;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Properties;

import javax.sql.DataSource;

import org.apache.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.simple.SimpleJdbcInsert;
import org.springframework.stereotype.Repository;

import com.bamsa.db.beans.ContactBean;
import com.bamsa.db.dao.ContactDAO;
import com.bamsa.db.impls.mappers.AccountDetailsRowMapper;
import com.bamsa.db.impls.mappers.AccountOwnerRowMapper;
import com.bamsa.db.impls.mappers.HotlistRowMapper;
import com.bamsa.db.util.DBConstants;
@Repository
public class ContactDAOImpl implements ContactDAO{
	@Autowired
	private Properties dbProps;
	@Autowired
	private JdbcTemplate jdbcTemplate;
	private static Logger logger = Logger.getLogger(ContactDAOImpl.class);
	@Override
	public ContactBean saveContactdetails(ContactBean contactdetails) {
		logger.info("enter into saveContactdetails");
		DataSource dataSource = jdbcTemplate.getDataSource();
		try{
		if(null != contactdetails){
			SimpleJdbcInsert jdbcInsert = new SimpleJdbcInsert(dataSource);
			
			Map<String,Object> recordParameters = new HashMap<String,Object>();
			recordParameters.put("accountname", contactdetails.getAccountName());
			recordParameters.put("accountowner", contactdetails.getAccountOwner());
			recordParameters.put("category", contactdetails.getCategory());
			recordParameters.put("website", contactdetails.getWebsite());
			recordParameters.put("status", contactdetails.getStatus());
			
			recordParameters.put("phoneno", contactdetails.getPhoneno());
			recordParameters.put("state", contactdetails.getState());
			recordParameters.put("city", contactdetails.getCity());
			recordParameters.put("primaryemail", contactdetails.getPrimaryemail());
			recordParameters.put("firstname", contactdetails.getFirstname());
			recordParameters.put("lastname", contactdetails.getLastname());
			recordParameters.put("secondaryemail", contactdetails.getSecondaryemail());
			recordParameters.put("reclist", contactdetails.getReqlist());
			recordParameters.put("hotlist", contactdetails.getHotlist());
			recordParameters.put("createddate", contactdetails.getCreateddate());
			logger.info(recordParameters);
            jdbcInsert.withTableName("accountinfo")
			.usingGeneratedKeyColumns("acid");	
			contactdetails.setAcid(jdbcInsert.executeAndReturnKey(recordParameters).intValue());
		}
		}catch(Exception e){
			logger.error(e.getMessage());
		}
		logger.info("exit from saveContactdetails");
		return contactdetails;		
	}
	@Override
	public List<ContactBean> getAccountDetails()
	{
		logger.info("enter into getaccountdetails");
		String accountquery=dbProps.getProperty(DBConstants.LOAD_ACCOUNT_DETAILS);
		logger.info(accountquery);
		List<ContactBean> accountno=jdbcTemplate.query(accountquery,new AccountDetailsRowMapper());
		logger.info(accountno);
		logger.info("exit from getaccountdetails");
		return accountno;
	}
	@Override
	public ContactBean getAccountOwnerdetails(String accountowner) {
		logger.info("enter into getAccountOwnerdetails");
		String ownerdetails=dbProps.getProperty(DBConstants.LOAD_ACCOUNTOWNER_DETAILS);
		logger.info(ownerdetails);
		List<ContactBean> ownerdet=jdbcTemplate.query(ownerdetails, new Object[]{accountowner}, new AccountOwnerRowMapper());
		logger.info(ownerdet);
		logger.info("exit from getAccountOwnerdetails");
		return ownerdet.get(0);
	}
	@Override 
	public List<ContactBean> getHotlistdetails() {
		logger.info("enter into getHotlistdetails");
		String hotlists =dbProps.getProperty(DBConstants.HOTLIST_CANDIDATES);
		logger.info(hotlists);
		List<ContactBean> details=jdbcTemplate.query(hotlists,new HotlistRowMapper());
		logger.info(details);
		logger.info("exit from getHotlistdetails");
		return details;
	}
	@Override
	public List<ContactBean> getReqlistdetails() {
		logger.info("enter into getReqlistdetails");
		String reqlists=dbProps.getProperty(DBConstants.REQLIST_CANDIDATES);
		List<ContactBean> details=jdbcTemplate.query(reqlists, new HotlistRowMapper());
		logger.info(details);
		logger.info("exit from getReqlistdetails");
		return details;
	}
	
	
	

		}
